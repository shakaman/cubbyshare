{% import "bootstrap/wtf.html" as wtf %}
{% import "bootstrap/utils.html" as utils %}

{%- extends "base.html" %}


{% block content %}
   <div class="container">
   <div class="col-md-12">

    {% if result_url %}
<script type=text/javascript>
  document.addEventListener("DOMContentLoaded", function() {
    const fetchDataLink = document.getElementById("fetch_data");

    fetchDataLink.addEventListener("click", function handleClick(event) {
      event.preventDefault(); // Prevent the default action

      // Prevent further clicks by removing the event listener
      fetchDataLink.removeEventListener("click", handleClick);

      // Visually indicate the link is disabled
      fetchDataLink.classList.add('disabled');

      fetch({{ result_url }}, { method: "POST"})
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json(); // Assuming the response is JSON
        })
        .then(data => {
          const resultElement = document.getElementById("result");
          resultElement.textContent = data.result;
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        })
      });
  });
</script>

    <p class="text-center"><a class="btn btn-primary" href="#" role="button" id="fetch_data">Click to show the secret</a></p>
    <p class="h4 text-center mb-4">Remember, this is the last time you see it.</p>
    <br>
<pre>
<span id=result></span>
</pre>
    {% endif %}

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class=flashes>
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {% if form %}
    <section class="form-elegant">
    <form method="POST" action="{{ url_for('frontend.add_entry') }}">
        {{ form.csrf_token }}

        <p class="h4 text-center mb-4">Put here the secret you want to share.</p>
        <p class="h4 text-center mb-4">It will be available for the next 24h.</p>
        <p class="h4 text-center mb-4">After the first reading, it will self-destruct.</p>
        <br><br>
        <textarea type="text" id="defaultFormContactMessageEx" class="form-control" rows="6" name="secrets"></textarea>
        <br><br>
        <div class="text-center mb-3">
            <button type="submit" class="btn blue-gradient btn-block btn-rounded z-depth-1a">Save my secret</button>
        </div>
    </form>
    </section>
    {% endif %}

  </div>
  </div>
{%- endblock %}
